
process {

    // set default publishing 
    publishDir = [
        path: { "${params.outdir}/${task.process.tokenize(':')[-1].tokenize('_')[0]}" },
        mode: params.output_mode,
        saveAs: { filename -> filename.equals('versions.yml') ? null : filename }
    ]
    
    withName: VG_PACK {
        ext.args = { [ 
            '-a'
        ].join(' ').trim() }
    } 

    withName: VG_PACK {
        ext.args = { [ 
            params.min_mapping_quality ? "-Q ${params.min_mapping_quality}" : '',
            params.ignore_first_last_bps ? "-s ${params.ignore_first_last_bps}" : '',
        ].join(' ').trim() }
    } 
    
    withName: VG_FILTER {
        ext.args = { [
            params.min_primary_score ? "-r ${params.min_primary_score}" : '',
            params.norm_based_on_length ? '-f' : '',
            params.use_sub_counts ? '-u' : '',
            params.min_end_matches ? "-m ${params.min_end_matches}" : '',
            params.min_map_qual ? "-q ${params.min_map_qual}" : '',
            params.defray_ends ? "-D ${params.defray_ends}" : '',
        ].join(' ').trim() } 
        
    }
    withName: BCFTOOLS_INDEX {
        ext.args = { [
            params.enable_tbi ? '-t' : ''
        ].join(' ').trim() }
    }
}